연습문제 

- 연도별 직업별 SAL평균 

  1981년도에 입사한 사람중 부서 10,20 중에서 SAL 평균 1500 이상인 사람의 평균SAL을 출력하세요

- ``` SQL
  SELECT TO_CHAR(HIREDATE,'YYYY') AS YEAR,JOB, ROUND(AVG(SAL),1) FROM EMP GROUP BY TO_CHAR(HIREDATE,'YYYY'),JOB HAVING TO_CHAR(HIREDATE,'YYYY') IN ('1981') AND AVG(SAL) >1500 ORDER BY JOB
  ```



- 입사한 달로 사원들을 그룹짓고

  DEPTNO가 20,30 이고 4, 5, 12월에 입사한 사원들의 평균임금을 출력한다.

  MONTH 오름차순으로 출력한다.

  

- ``` SQL 
  SELECT TO_CHAR(HIREDATE,'MM') AS MONTH, AVG(SAL) FROM EMP GROUP BY TO_CHAR(HIREDATE,'MM') HAVING TO_CHAR(HIREDATE,'MM') IN('04','05','12') ORDER BY MONTH
  ```





- 직업별 입사 월별 월급의 최대값을 구하시오.

  단 이름에 S가 들어간 사람을 대상으로 하고

  입사 월이 12월인 사람을 대상으로 하시오.

  - ``` SQL
    SELECT JOB, TO_CHAR(HIREDATE,'MM') AS MONTH , MAX(SAL) FROM EMP WHERE ENAME LIKE '%S%' GROUP BY JOB ,TO_CHAR(HIREDATE,'MM') HAVING TO_CHAR(HIREDATE,'MM') IN('12') 
    ```

- 고용 월별, 직업별로 SAL+COMM의 평균을 출력하고

  SAL+COMM의 평균이 2000이상이며

  ENAME에 A가 있는 경우를 고용 월별을 기준으로 

  내림차순으로 정렬하시오
  - ``` SQL 
    SELECT JOB, TO_CHAR(HIREDATE,'MM') AS MONTH, AVG(SAL + NVL(COMM,0)) FROM EMP WHERE ENAME LIKE '%A%' GROUP BY JOB, TO_CHAR(HIREDATE,'MM') HAVING AVG(SAL + NVL(COMM,0))> 2000 ORDER BY MONTH DESC;
    ```

- 
  EMP 테이블에서 JOB별, MGR별 ENAME을 구하시오. 

  단, HIREDATE가 9월, 12월이며, MGR이 7698이다.

  그리고 JOB 오름차순으로 정렬하시오. 

  - ``` SQL 
    SELECT JOB, MGR, ENAME FROM EMP WHERE TO_CHAR(HIREDATE,'MM') IN('09','12') GROUP BY JOB, MGR, ENAME HAVING MGR IN ('7698') ORDER BY JOB 
    ```

- JOB 별 SALARY의 평균을 구하고 평균이 2000이상인 그룹중에서 

  가장 큰 평균을 갖은 그룹과 가장 작은 평균을 갖은 그룹의 액수를 각각 출력하시오.

  - ``` SQL
    SELECT MAX(A), MIN(A) FROM (SELECT JOB, AVG(SAL) AS A FROM EMP GROUP BY JOB HAVING AVG(SAL) >2000 )
    ```



- 부서별 월급의 평균을 조회하는 VIEW를 작성하시오 

  - ``` SQL
    CREATE VIEW AVGSALVIEW(DEPTNO, AVGSAL) AS SELECT DEPTNO, AVG(SAL) FROM EMP GROUP BY DEPTNO
    ```

- DALLAS의 있는 사람의 이름을 조회하시오

  - ```SQL
    SELECT DEPTNO FROM DEPT WHERE LOC = 'DALLAS'
    
    SELECT ENAME FROM EMP WHERE DEPTNO = 20
    ```

- FOREIGN KEY... 

- ```SQL
  CREATE TABLE ITEM( ID VARCHAR2(10), NAME VARCHAR2(20), CATE NUMBER(10))
  CREATE TABLE CATEGORY( NO MUMBER(20), NAME VARCHAR2(20))
  
  ALTER TABLE ITEM ADD CONSTRAINT PRIMARY KEY(ID)
  ALTER TABLE CATEGORY ADD CONSTRAINT PRIMARY KEY(ID)
  ```

- ``` SQL
  CREATE TABLE ITEM( ID VARCHAR2(10), NAME VARCHAR2(20), CATE NUMBER(10))
  CREATE TABLE CATEGORY( NO NUMBER(20), NAME VARCHAR2(20))
  
  
  ALTER TABLE ITEM ADD PRIMARY KEY(ID)
  ALTER TABLE CATEGORY ADD PRIMARY KEY(NO)
  
  INSERT INTO CATEGORY VALUES(100,'의류')
  INSERT INTO CATEGORY VALUES(200,'잡화')
  INSERT INTO CATEGORY VALUES(300,'소품')
  
  DELETE FROM ITEM WHERE ID = 'IT01'
  
  ALTER TABLE ITEM ADD FOREIGN KEY(CATE) REFERENCES CATEGORY(NO)
  
  ```

- ``` SQL
  SELECT ENAME, SAL, AVG(SAL) FROM EMP  -- 불가능
  SELECT ENAME, SAL , (SELECT AVG(SAL) FROM EMP ) FROM EMP ; --모든 ROW에 평균표시.
  ```



- JOB 별 평균 월급보다 많이 받는 사람 을 조회하시오 

  - ``` SQL
    SELECT JOB, ENAME, SAL FROM EMP e1 WHERE SAL >(
    SELECT AVG(SAL) FROM EMP e2 WHERE e1.JOB = e2.JOB GROUP BY JOB ) 
    ```

- 부서별 월급이 가장 많은사람의 DEPTNO, ENAME,SAL을 조회하시오

  - ```SQL
    SELECT DEPTNO,ENAME,SAL FROM EMP E1 WHERE SAL >= (SELECT MAX(SAL) FROM EMP E2 WHERE E2.DEPTNO = E1.DEPTNO GROUP BY DEPTNO)
    ```

- 'CHICAGO ' 지역의 평균 월급보다 높은 사람들의 JOB 별 SAL 를  (JOB,ENAME,YYYY,SAL) 로 나타내시오

  - ```SQL
    SELECT JOB, ENAME , TO_CHAR(HIREDATE,'YYYY'),SAL FROM EMP WHERE SAL > (SELECT AVG(SAL) FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC IN ('CHICAGO') GROUP BY D.LOC) ORDER BY SAL DESC 
    ```



- 지역별 ... (강진이 문제 )

  - ``` SQL 
    1. 지역별 평균
    SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC
    
    2.지역별 평균중 MAX 지역
    SELECT MAX(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC)
    
    SELECT MIN(SAL)AS D FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC = (SELECT MAX(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC))
    
    3. 지역별 평균중 MIN지역 
    SELECT MIN(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC)
    
    SELECT MAX(SAL) AS C FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC=(SELECT MIN(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC))
    
    
    SELECT MAX(C) FROM (
    SELECT MAX(SAL) AS C FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC=(SELECT MIN(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC))
    UNION
    SELECT MIN(SAL)AS D FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND D.LOC = (SELECT MAX(A) FROM (SELECT AVG(SAL), LOC AS A FROM EMP E, DEPT D  WHERE E.DEPTNO = D.DEPTNO GROUP BY LOC)))
    
    
    ```

- 지역별 입사일이 가장 늦은 사원의 정보를 출력 하시오 LOC,ENAME,HIREDATE 

  - ``` SQL
    SELECT D.LOC,E.ENAME, E.HIREDATE FROM EMP E, DEPT D WHERE E.DEPTNO= D.DEPTNO 
    AND HIREDATE IN (SELECT MAX(HIREDATE) FROM EMP E1, DEPT D1
    WHERE D1.DEPTNO = E1.DEPTNO 
    AND D.LOC = D1.LOC
    GROUP BY D.LOC) ORDER BY D.LOC
    ```

  - 