AWS Builders

- AWS 100 / 200 / 300

- 루키 - 프로 - 마스터 



I . I AM (권한 작업)

- Root권한 
- 사용자 권한
- 태그 : 나중에 계정이 많아졌을 때, 태그를 이용해 태그에 속해있는 사용자만 권한을 바꾼다거나 한꺼번에 처리

- 그룹추가 :

  - AWS 로그인 후 IAM 검색으로 > 그룹 추가 기능
    - 그룹이름
    - 정책
    - 검토

  

II. MFA (Multi-Factor Authentication)

- 오늘은 웹에서 사용하는 토큰으로 2중보안 설정 해보기

- 루트권한으로 로그인 할때만 발동

- Authy 2-Factor Authentication 앱을 받아서 핸드폰에서 키 등록.

  해당 핸드폰으로 OTP 마냥 인증번호 (MFA code) 전송된다고 함.

  근데 핸드폰을 잃어버리면 큰일나는데, 번호를 따라간다고하니까.. 번호만 킵하면 된다고 함.





III. 실습

1. 언어 : 한국어

2. Region : 서울

   서울로 설정하면 서울에 있는 Resource들을 활용 할 수 있음.

3. 과정 

   1.  네트워크 구성 
   2.  웹 서버 생성
   3.  로드 밸런서 구성  : 트래픽 관리





네트워크 구성

I. VPC (Virtual Private Cloud)

나만이 가지고 있는 네트워크 공간을 할당 받음

- 가용영역 ?

  - 하나의 가용영역은 복수개의 clustering된 데이터 센터로 이루어짐
  - 가용영역 == RAID같은 느낌이랄까.. 하나의 가용영역에 문제가 생기면 다른 가용영역 이니.. 
  - 물리적으로 나뉘어져 있음. 그런데 성능 issue가 있을 수 있으니 높은 Bandwidth의 광연결

  - 용도에 맞춰서 서브넷들을 가용영역에 생성
  - 외부에 노출 되야 한다  : 퍼블릭 서브넷
  - DB같이 외부에 노출 x : 프라이빗 서브넷.

- 주소 할당 (CIDR 블럭)

  - 고정범위 설정, 뒤에 숫자 /16
  - 고정 숫자가 클 수록 고정된 IP자리수가 많아지므로 할당할 수 있는 IP는 적어짐. 
  - 향후 확장을 고려하여 충분히 큰 주소를 할당해야 함.
  - Region간에 통신해야 하는 경우가 있음. 그럴경우 주소 충돌이 날 수 있으므로 범위설정에 신중해야 함.

- Routing Table

  - Private Subnet은 따로 라우팅 테이블이 존재하므로 연결하지 말 것.

- 보안

  - 보안그룹

    - 사용하기 쉬움

    - 조금 더 다양하게 사용가능

    - 웹 , 앱, DB 각각 따로따로 보안그룹을 생성해야함.

    - 인바운드 규칙

      - 인바운드 허용 규칙을 만드는 거임

      - 80으로 들어왔는데 아웃바운드에 80이 막혀잇더라도 다시 리턴 가능.

      - SSH 전세계에서 접근가능하게 디폴트로 되어있으므로

        우리 회사 내에서만 접근가능하도록 바꿔줘야함.

      - 

      

  - NACL (보조적 수단)

    - state less
      - 인바운드 80번 포트로 세션이 들어왔을때 아웃바운드 규칙에 80이 막혀있으면 리턴 불가.
    - state full

  

  II. EC2 (Elastic Compute Cloud)

  - 다양한 크기의 코어 제공
  - 다양한 os 지원 (리눅스, 윈도우 etc..)

  - 퍼블릭 아이피 자동할당 : 활성화 
  - 실습 : 쉘 스크립트 돌려서 자동으로 웹페이지 생성.
  - 인스턴스에 접속할때 Key를 통해 접속
  - SSH 키 잃어버리면 못들어가므로 kEy는 소중하게 보관

  

  - AMI
    - 이미지를 복사함

  

  III. 로드 밸런서

  - 앞단에 로드밸런서가 위치하여 수많은 트래픽을 분산시켜서 뒤에 나눠줌

  - 트래픽 분산장치라고 이해하면 편함.

  - 보안그룹 로드밸런서는 전체 0.0.0.0 에대해서 모두 열어두고 웹서버에서는 로드벨런서에서 들어오는것만 허용하고 나머지 다 막으면 됨 

  - 로드벨런서는 내 트래픽을 받을 웹서버가 잘 살아있는지 헬스 체크를 주기적으로 함.

    정상 임계 값 : n번이상 보내고 n번 이상 ok

    비정상 : n 만큼 응답 없을때

    제한시간 : n초 안에 응답이면 ok , 넘어가면 비정상

    간격 : n초마다 보내기 

오토 스케일링

- 새로 추가된 인스턴스가 있을경우, 로드밸런서가 알아서 인지하고 리스트에 추가하여 트래픽을 보내주게 됨

